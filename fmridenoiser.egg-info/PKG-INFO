Metadata-Version: 2.4
Name: fmridenoiser
Version: 1.0.0
Summary: fMRI Denoising BIDS App for fMRIPrep Outputs
Home-page: https://github.com/ln2t/fmridenoiser
Author: ln2t
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Scientific/Engineering :: Medical Science Apps.
Requires-Python: >=3.9
Description-Content-Type: text/markdown
Requires-Dist: nibabel>=5.2.0
Requires-Dist: nilearn>=0.10.3
Requires-Dist: numpy>=1.24.0
Requires-Dist: pandas>=2.0.0
Requires-Dist: scipy>=1.10.0
Requires-Dist: pybids>=0.16.4
Requires-Dist: PyYAML>=6.0
Requires-Dist: matplotlib>=3.7.0
Requires-Dist: seaborn>=0.12.0
Requires-Dist: colorama>=0.4.6
Requires-Dist: tqdm>=4.65.0
Dynamic: author
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# fmridenoiser

**fMRI Denoising BIDS App for fMRIPrep Outputs**

fmridenoiser applies denoising (confound regression + temporal filtering) and optional FD-based temporal censoring to fMRI data preprocessed with [fMRIPrep](https://fmriprep.org). It produces BIDS-compliant denoised outputs that can be used as input to downstream tools like [connectomix](https://github.com/ln2t/connectomix).

## Features

- **9 predefined denoising strategies** based on neuroimaging best practices (Wang et al. 2024)
- **FD-based motion censoring** with configurable threshold, extension, and segment filtering (scrubbing)
- **Geometric consistency** checking and resampling across subjects
- **BIDS-compliant** outputs with JSON sidecars for provenance tracking
- **HTML quality reports** with denoising histograms, confound time series, and FD traces
- **Wildcard support** for confound selection (e.g., `a_comp_cor_*`)

## Installation

```bash
pip install fmridenoiser
```

Or from source:

```bash
git clone https://github.com/ln2t/fmridenoiser.git
cd fmridenoiser
pip install -e .
```

## Quick Start

```bash
# Basic denoising with a predefined strategy
fmridenoiser /data/bids /data/derivatives/denoised participant --strategy csfwm_6p

# Process a specific subject
fmridenoiser /data/bids /data/output participant --participant-label 01 --strategy minimal

# With FD-based motion censoring
fmridenoiser /data/bids /data/output participant --strategy csfwm_6p --fd-threshold 0.5

# Using scrubbing5 strategy (includes FD censoring)
fmridenoiser /data/bids /data/output participant --strategy scrubbing5

# Specify fMRIPrep derivatives location
fmridenoiser /data/bids /data/output participant \
    --derivatives fmriprep=/path/to/fmriprep \
    --strategy gs_csfwm_12p
```

## Denoising Strategies

| Strategy | Confounds | Description |
|----------|-----------|-------------|
| `minimal` | 6 motion params | Motion parameters only |
| `csfwm_6p` | CSF + WM + 6 motion | Standard physiological + motion |
| `csfwm_12p` | CSF + WM + 12 motion | With motion derivatives |
| `gs_csfwm_6p` | GS + CSF + WM + 6 motion | With global signal regression |
| `gs_csfwm_12p` | GS + CSF + WM + 12 motion | GSR + motion derivatives |
| `csfwm_24p` | CSF + WM + 24 motion | Full motion model |
| `compcor_6p` | 6 aCompCor + 6 motion | Data-driven + motion |
| `simpleGSR` | GS + CSF + WM + 24 motion | Preserves time series continuity |
| `scrubbing5` | CSF/WM deriv + 24 motion + FD=0.5cm + scrub=5 | Maximum denoising quality |

## Output Structure

```
output_dir/
├── dataset_description.json
├── config/
│   └── backups/
│       └── denoising_config_YYYYMMDD_HHMMSS.json
└── sub-01/
    ├── func/
    │   ├── sub-01_task-rest_space-MNI_denoise-csfwm6p_desc-denoised_bold.nii.gz
    │   └── sub-01_task-rest_space-MNI_denoise-csfwm6p_desc-denoised_bold.json
    ├── figures/
    │   └── [QA figures]
    └── sub-01_task-rest_desc-csfwm6p_denoising-report.html
```

## Integration with connectomix

fmridenoiser is designed to work as a preprocessing step before [connectomix](https://github.com/ln2t/connectomix):

```bash
# Step 1: Denoise with fmridenoiser
fmridenoiser /data/bids /data/derivatives/denoised participant --strategy csfwm_6p

# Step 2: Compute connectivity with connectomix
connectomix /data/bids /data/derivatives/connectivity participant \
    --denoised-derivatives /data/derivatives/denoised \
    --method roiToRoi --atlas schaefer2018n100
```

## References

- **fMRIPrep**: Esteban et al. (2019). fMRIPrep: a robust preprocessing pipeline for functional MRI. *Nature Methods*, 16, 111-116.
- **Nilearn**: Abraham et al. (2014). Machine learning for neuroimaging with scikit-learn. *Frontiers in Neuroinformatics*, 8, 14.
- **Denoising strategies**: Wang et al. (2024). Benchmarking fMRI denoising strategies for functional connectomics.
- **Motion scrubbing**: Power et al. (2012). Spurious but systematic correlations in functional connectivity MRI networks arise from subject motion. *NeuroImage*, 59, 2142-2154.

## License

MIT License
